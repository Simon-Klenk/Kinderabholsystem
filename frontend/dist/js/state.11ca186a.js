"use strict";(self["webpackChunkkinderabholung"]=self["webpackChunkkinderabholung"]||[]).push([[522],{2238:function(e,t,s){s.r(t),s.d(t,{default:function(){return m}});var a=s(6768),n=s(4232);const i={class:"message-create"},r={key:0,class:"status-offline"},c=["disabled"],l={key:1,class:"success"},o={key:2,class:"error"};function d(e,t,s,d,h,u){return(0,a.uX)(),(0,a.CE)("div",i,[t[2]||(t[2]=(0,a.Lk)("h2",{class:"message-title"},"Notfall - Hilfe anfordern",-1)),h.isRaspberryOnline?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.CE)("p",r," ❌ System funktioniert aktuell nicht - AV kann nicht benachrichtigt werden!! ")),t[3]||(t[3]=(0,a.Lk)("div",{class:"message-text"}," Du sendest zur Anzeige auf der LED-Wall folgene Nachricht an AV: ",-1)),t[4]||(t[4]=(0,a.Lk)("div",{class:"spaced-text"},[(0,a.Lk)("strong",null," Medizinischer Notfall: Sanitäter / Arzt / Fachpersonal - bitte zum Kids Check-In kommen! ")],-1)),(0,a.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>u.confirmAndSendMessage&&u.confirmAndSendMessage(...e)),disabled:!h.isRaspberryOnline||h.isSubmitting,class:"spaced-button"}," Notfallnachricht senden ",8,c),h.successMessage?((0,a.uX)(),(0,a.CE)("div",l,t[1]||(t[1]=[(0,a.Lk)("p",null,"Nachricht erfolgreich gesendet!",-1)]))):(0,a.Q3)("",!0),h.errorMessage?((0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("p",null,(0,n.v_)(h.errorMessage),1)])):(0,a.Q3)("",!0)])}s(4114);var h={data(){return{successMessage:null,errorMessage:null,isSubmitting:!1,isRaspberryOnline:!1}},methods:{async checkRaspberryStatus(){try{const e=await fetch("http://192.168.104.45/api/live/");this.isRaspberryOnline=e.ok}catch(e){this.isRaspberryOnline=!1}},async sendMessage(){this.isSubmitting=!0;try{const e=await fetch("http://192.168.104.45/api/emergency/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:"Medizinischer Notfall: Sanitäter / Arzt / Fachpersonal - bitte zum Kids Check-In kommen!",status:"sent"})});if(!e.ok)throw new Error(`HTTP-Fehler: ${e.status}`);this.successMessage="Nachricht erfolgreich gesendet!",this.errorMessage=null,setTimeout((()=>this.$router.push("/state")),1500)}catch(e){this.errorMessage=`Fehler beim Senden: ${e.message}`}finally{this.isSubmitting=!1}},confirmAndSendMessage(){confirm("Sicher, dass du senden möchtest?")&&this.sendMessage()}},mounted(){this.checkRaspberryStatus()}},u=s(1241);const g=(0,u.A)(h,[["render",d],["__scopeId","data-v-5600711e"]]);var m=g},8619:function(e,t,s){s.r(t),s.d(t,{default:function(){return C}});var a=s(6768);const n={class:"messages-container"},i={key:0,class:"loading"},r={key:1};function c(e,t,s,c,l,o){const d=(0,a.g2)("MessageItem");return(0,a.uX)(),(0,a.CE)("div",n,[t[0]||(t[0]=(0,a.Lk)("h2",{class:"messages-title"},"Gesendete Nachrichten",-1)),l.loading?((0,a.uX)(),(0,a.CE)("div",i,"⏳ Lade Nachrichten...")):((0,a.uX)(),(0,a.CE)("div",r,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(l.messages,(e=>((0,a.uX)(),(0,a.Wv)(d,{key:e.id,text:e.content,date:e.created_at,state:e.status},null,8,["text","date","state"])))),128))]))])}var l=s(4232);const o={class:"message-item"},d={key:0},h={key:1,class:"message-text"},u={class:"message-meta"},g={class:"message-date"},m={class:"message-state"},p={key:0,class:"tooltip"};function f(e,t,s,n,i,r){return(0,a.uX)(),(0,a.CE)("div",o,[s.text.includes("Medizinischer Notfall:")?((0,a.uX)(),(0,a.CE)("div",d,[(0,a.Lk)("strong",null,(0,l.v_)(s.text),1)])):((0,a.uX)(),(0,a.CE)("div",h,[t[1]||(t[1]=(0,a.eW)(" Die Eltern von ")),(0,a.Lk)("strong",null,(0,l.v_)(s.text),1),t[2]||(t[2]=(0,a.eW)(" bitte zum Check-in kommen "))])),(0,a.Lk)("div",u,[(0,a.Lk)("span",g,(0,l.v_)(r.formattedDate),1),(0,a.Lk)("div",m,[(0,a.Lk)("span",{class:(0,l.C4)(r.statusClass)},(0,l.v_)(r.translatedState),3),(0,a.Lk)("span",{class:"info-icon",onClick:t[0]||(t[0]=(...e)=>r.toggleTooltip&&r.toggleTooltip(...e))},"❓"),i.showTooltip?((0,a.uX)(),(0,a.CE)("div",p,(0,l.v_)(r.statusExplanation),1)):(0,a.Q3)("",!0)])])])}var k={name:"MessageItem",props:{text:String,date:String,state:String},data(){return{showTooltip:!1}},computed:{formattedDate(){return new Date(this.date).toLocaleString()},translatedState(){const e={received:"Wartet auf Freigabe",approved:"Wird angezeigt",rejected:"Wurde abgelehnt",sent:"An AV Gesendet",displayed:"Wurde angezeigt"};return e[this.state]||this.state},statusExplanation(){const e={received:"Das AV-Team hat deine Nachricht erhalten. Es entscheidet jetzt wann und ob es deine Nachricht auf der LED-Wall anzeigt. Du wirst hier informiert, sobald es eine Entscheidung trifft",approved:"Das AV-Team zeigt deine Nachricht gerade auf der LED-Wall an.",rejected:"Das AV-Team hat entschieden deine Nachricht nicht auf der LED-Wall anzuzeigen.",sent:"Deine Nachricht wird gerade an das AV-Team gesendet, ist aber noch nicht dort angekommen.",displayed:"Deine Nachricht ist jetzt nicht mehr auf der LED-Wall zu sehen. Sie wurde aber angezeigt."};return e[this.state]||""}},methods:{toggleTooltip(){this.showTooltip=!this.showTooltip},statusClass(){return{"status-pending":"received"===this.state,"status-success":"approved"===this.state,"status-error":"rejected"===this.state,"status-sent":"sent"===this.state,"status-displayed":"displayed"===this.state}}}},v=s(1241);const b=(0,v.A)(k,[["render",f],["__scopeId","data-v-35b7df33"]]);var y=b,E={components:{MessageItem:y},data(){return{messages:[],loading:!0,intervalId:null}},async created(){await this.getMessages(),this.startPolling()},beforeUnmount(){this.stopPolling()},methods:{async getMessages(){try{let e=await fetch("http://192.168.104.45/api/messages/",{method:"GET"});if(!e.ok)throw new Error(`HTTP-Fehler! Status: ${e.status}`);this.messages=await e.json(),this.loading=!1}catch(e){console.error("Fehler beim Abrufen der Nachrichten:",e),this.loading=!1}},startPolling(){this.intervalId=setInterval(this.getMessages,4e3)},stopPolling(){this.intervalId&&clearInterval(this.intervalId)}}};const S=(0,v.A)(E,[["render",c],["__scopeId","data-v-4e32ca43"]]);var C=S}}]);
//# sourceMappingURL=state.11ca186a.js.map